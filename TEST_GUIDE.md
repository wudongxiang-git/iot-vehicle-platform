# API æµ‹è¯•æŒ‡å—

**ä½œè€…**: dongxiang.wu  
**æ—¥æœŸ**: 2025-10-28

---

## ğŸš€ å¿«é€Ÿæµ‹è¯•æ­¥éª¤

### å‰ç½®å‡†å¤‡

1. **ç¡®ä¿DockeræœåŠ¡è¿è¡Œ**
   ```bash
   docker-compose ps
   # ç¡®è®¤ postgresã€redisã€emqx éƒ½åœ¨è¿è¡Œ
   ```

2. **åˆå§‹åŒ–æ•°æ®åº“**ï¼ˆé¦–æ¬¡ä½¿ç”¨éœ€è¦ï¼‰
   ```bash
   # é‡æ–°åˆ›å»ºæ•°æ®åº“ï¼ˆä¼šæ‰§è¡Œæ‰€æœ‰åˆå§‹åŒ–è„šæœ¬ï¼‰
   docker-compose down -v
   docker-compose up -d postgres
   
   # ç­‰å¾…30ç§’è®©åˆå§‹åŒ–è„šæœ¬æ‰§è¡Œå®Œæˆ
   sleep 30
   ```

3. **å¯åŠ¨åº”ç”¨**
   ```bash
   cd iot-vehicle-web
   mvn spring-boot:run
   ```

---

## ğŸ“ æµ‹è¯•æ­¥éª¤

### æ–¹å¼1ï¼šä½¿ç”¨ Knife4j æ–‡æ¡£æµ‹è¯•ï¼ˆæ¨èï¼‰

1. **è®¿é—® Knife4j æ–‡æ¡£**
   
   æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼šhttp://localhost:8080/api/doc.html

2. **æµ‹è¯•ç”¨æˆ·æ³¨å†Œ**
   
   æ‰¾åˆ° `è®¤è¯ç®¡ç†` â†’ `ç”¨æˆ·æ³¨å†Œ`
   
   è¯·æ±‚ä½“ï¼š
   ```json
   {
     "username": "testuser",
     "password": "123456",
     "nickname": "æµ‹è¯•ç”¨æˆ·",
     "email": "test@example.com",
     "phone": "13800138000"
   }
   ```
   
   ç‚¹å‡»ã€Œè°ƒè¯•ã€â†’ã€Œå‘é€ã€
   
   **é¢„æœŸç»“æœ**ï¼š
   ```json
   {
     "code": 200,
     "message": "æ³¨å†ŒæˆåŠŸ",
     "timestamp": 1730134567890
   }
   ```

3. **æµ‹è¯•ç”¨æˆ·ç™»å½•**
   
   æ‰¾åˆ° `è®¤è¯ç®¡ç†` â†’ `ç”¨æˆ·ç™»å½•`
   
   è¯·æ±‚ä½“ï¼š
   ```json
   {
     "username": "admin",
     "password": "admin123"
   }
   ```
   
   ç‚¹å‡»ã€Œè°ƒè¯•ã€â†’ã€Œå‘é€ã€
   
   **é¢„æœŸç»“æœ**ï¼š
   ```json
   {
     "code": 200,
     "message": "æ“ä½œæˆåŠŸ",
     "data": {
       "accessToken": "eyJhbGciOiJIUzUxMiJ9...",
       "tokenType": "Bearer",
       "expiresIn": 604800,
       "userInfo": {
         "id": 1,
         "username": "admin",
         "nickname": "è¶…çº§ç®¡ç†å‘˜"
       }
     }
   }
   ```

4. **å¤åˆ¶ Token**
   
   å¤åˆ¶è¿”å›çš„ `accessToken`

5. **é…ç½®å…¨å±€ Token**
   
   åœ¨ Knife4j é¡µé¢å³ä¸Šè§’ç‚¹å‡»ã€Œæ–‡æ¡£ç®¡ç†ã€â†’ã€Œå…¨å±€å‚æ•°è®¾ç½®ã€
   
   æ·»åŠ å‚æ•°ï¼š
   - å‚æ•°åï¼š`Authorization`
   - å‚æ•°å€¼ï¼š`Bearer <ä½ çš„token>`
   - å‚æ•°ç±»å‹ï¼š`header`

6. **æµ‹è¯•éœ€è¦ç™»å½•çš„æ¥å£**
   
   æ‰¾åˆ° `ç”¨æˆ·ç®¡ç†` â†’ `è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯`
   
   ç‚¹å‡»ã€Œè°ƒè¯•ã€â†’ã€Œå‘é€ã€
   
   **é¢„æœŸç»“æœ**ï¼šè¿”å›å½“å‰ç™»å½•ç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯

---

### æ–¹å¼2ï¼šä½¿ç”¨ test-api.http æ–‡ä»¶æµ‹è¯•

åœ¨ IntelliJ IDEA ä¸­æ‰“å¼€ `test-api.http` æ–‡ä»¶ï¼Œé€ä¸ªç‚¹å‡»è¿è¡Œã€‚

---

### æ–¹å¼3ï¼šä½¿ç”¨ curl å‘½ä»¤æµ‹è¯•

#### 1. ç”¨æˆ·æ³¨å†Œ

```bash
curl -X POST http://localhost:8080/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "username": "testuser",
    "password": "123456",
    "nickname": "æµ‹è¯•ç”¨æˆ·",
    "email": "test@example.com",
    "phone": "13800138000"
  }'
```

#### 2. ç”¨æˆ·ç™»å½•

```bash
curl -X POST http://localhost:8080/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "username": "admin",
    "password": "admin123"
  }'
```

#### 3. è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯ï¼ˆéœ€è¦Tokenï¼‰

```bash
# æ›¿æ¢ <your-token> ä¸ºç™»å½•è¿”å›çš„ accessToken
curl -X GET http://localhost:8080/api/user/current \
  -H "Authorization: Bearer <your-token>"
```

#### 4. åˆ†é¡µæŸ¥è¯¢ç”¨æˆ·åˆ—è¡¨

```bash
curl -X GET "http://localhost:8080/api/user/page?current=1&size=10" \
  -H "Authorization: Bearer <your-token>"
```

---

## âœ… é¢„ç½®æµ‹è¯•è´¦å·

å·²åœ¨æ•°æ®åº“ä¸­åˆå§‹åŒ–ï¼š

| ç”¨æˆ·å | å¯†ç  | è§’è‰² | æƒé™ |
|--------|------|------|------|
| admin | admin123 | è¶…çº§ç®¡ç†å‘˜ | æ‰€æœ‰æƒé™ |

---

## ğŸ” åŠŸèƒ½éªŒè¯æ¸…å•

æµ‹è¯•å®Œæˆåæ‰“å‹¾ï¼š

- [ ] å¥åº·æ£€æŸ¥æ¥å£æ­£å¸¸
- [ ] Knife4jæ–‡æ¡£å¯è®¿é—®
- [ ] ç”¨æˆ·æ³¨å†ŒæˆåŠŸ
- [ ] ç”¨æˆ·ç™»å½•æˆåŠŸï¼ˆè¿”å›Tokenï¼‰
- [ ] Tokenèƒ½æ­£å¸¸è§£æ
- [ ] è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯æˆåŠŸ
- [ ] åˆ†é¡µæŸ¥è¯¢ç”¨æˆ·åˆ—è¡¨æˆåŠŸ
- [ ] æœªç™»å½•è®¿é—®å—ä¿æŠ¤æ¥å£è¿”å›401
- [ ] ä¿®æ”¹å¯†ç åŠŸèƒ½æ­£å¸¸

---

## ğŸ› å¸¸è§é—®é¢˜

### 1. æç¤º"ç”¨æˆ·åå·²å­˜åœ¨"

**åŸå› **ï¼šæ•°æ®åº“ä¸­å·²æœ‰è¯¥ç”¨æˆ·

**è§£å†³**ï¼šæ¢ä¸ªç”¨æˆ·åæˆ–æ¸…ç©ºæ•°æ®åº“

### 2. æç¤º"Tokenæ— æ•ˆæˆ–å·²è¿‡æœŸ"

**åŸå› **ï¼šTokenå·²è¿‡æœŸï¼ˆ7å¤©æœ‰æ•ˆæœŸï¼‰

**è§£å†³**ï¼šé‡æ–°ç™»å½•è·å–æ–°Token

### 3. æç¤º"è¯·å…ˆç™»å½•"

**åŸå› **ï¼šæœªæºå¸¦Tokenæˆ–Tokenæ ¼å¼é”™è¯¯

**è§£å†³**ï¼šæ£€æŸ¥ Authorization è¯·æ±‚å¤´æ ¼å¼ï¼š`Bearer <token>`

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœæµ‹è¯•é‡åˆ°é—®é¢˜ï¼Œè®°å½•ï¼š
1. è¯·æ±‚çš„æ¥å£è·¯å¾„
2. è¯·æ±‚å‚æ•°
3. å®Œæ•´çš„é”™è¯¯ä¿¡æ¯
4. åå°æ—¥å¿—

---

**ç¥æµ‹è¯•é¡ºåˆ©ï¼** ğŸ‰

